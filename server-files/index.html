<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0;
}

.beads circle {
  stroke: #fff;
  stroke-width: 0.1px;
}

</style>
<svg width="4000" height="4000"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

svg.append("rect")
   .attr("width", "100%")
   .attr("height", "100%")
   .attr("fill", "#dddddd");

// var color = d3.scaleOrdinal(d3.schemeCategory20);

function update(data) {
    var c = 0;
    // console.log(data.volume[0].length != undefined)
    if (data.hasOwnProperty('volume')) {
      svg.attr("width", data.volume[0].length)
         .attr("height", data.volume[0].length);
    } else if (data.hasOwnProperty('lines')) {
      for (l in data.lines) {
        svg.attr("class", "lines")
           .append("line")
           .attr("x1", data.lines[l].x1)
           .attr("y1", data.lines[l].y1)
           .attr("x2", data.lines[l].x2)
           .attr("y2", data.lines[l].y2)
           .style("stroke", "gray")
           .style("stroke-width", "2");
      }
    } else {
      d3.selectAll("circle").remove()
      for (var b in data.beads) {
          var circle = svg.attr("class", "beads")
              .append("circle")
              .attr("r", 10)
              .attr("cx", data.beads[b].x)
              .attr("cy", data.beads[b].y)
              .attr("id", data.beads[b].id)

          if (data.beads[b].type == "A") {
            circle.attr("fill", "#ff0000");
            c++;
          } else {
            circle.attr("fill", "#000000");
          }
      }
    }
    console.log(c);
}

// ----------------- Sockets ------------------------
// open the websocket for receiving the data
const socket = new WebSocket('ws://localhost:8079');

// grab data
socket.onmessage = function (evt) {
  var d = JSON.parse(evt.data);
  // d3.selectAll("rect").attr("fill", "#000000");
  update(d);
}

// d3.json("data.json", function(error, graph) {
//   if (error) throw error;

//   // var bead = svg.append("g")
//   //     .attr("class", "beads")
//   //   .selectAll("circle")
//   //   .data(graph.beads)
//   //   .enter()
//   //   .append("circle")
//   //     .attr("r", 10)
//   //     .attr("cx", function(d) { return (d.x); })
//   //     .attr("cy", function(d) { return (d.y); })
//   //     .attr("id", function(d) { return d.id+"_r"; } )
//       // .attr("fill", "#000000");

//     //   var link = svg.selectAll("line")
//     // .data(graph.links)
//     // .enter()
//     // .append("line")
//     //   .attr("x1", function(l) {
//     //                             var source = d3.selectAll('#'+l.source+"_r");
//     //                             return source.attr("cx");
//     //                           })
//     //   .attr("y1", function(l) {
//     //                             var source = d3.selectAll('#'+l.source+"_r");
//     //                             return source.attr("cy");
//     //                           })
//     //   .attr("x2", function(l) {
//     //                             var target = d3.selectAll('#'+l.target+"_r");
//     //                             return target.attr("cx");
//     //                           })
//     //   .attr("y2", function(l) {
//     //                             var target = d3.selectAll('#'+l.target+"_r");
//     //                             return target.attr("cy");
//     //                           })
//     //   .style("stroke", "gray")
//     //   .style("stroke-width", "2");

//     d3.selectAll(".beads").raise();

//   // function updateHeat(id, v) {
//   //   d3.selectAll('#'+id+"_r")
//   //     .attr("fill", d3.interpolateRdYlGn(v*5));
//   // }





// });

</script>

